# Агенты

LIDCO использует мультиагентную архитектуру, где специализированные агенты обрабатывают разные типы задач. Оркестратор направляет сообщения наиболее подходящему агенту.

## Встроенные агенты

| Агент | Имя | Описание |
|-------|-----|----------|
| Архитектор | `architect` | Проектирование систем, архитектурные решения, оценка технологий |
| Кодер | `coder` | Универсальное программирование: написание, модификация, реализация фич |
| Отладчик | `debugger` | Отладка ошибок, исправление багов, анализ трейсбэков |
| Документатор | `docs` | Написание документации, генерация README, докстринги |
| Планировщик | `planner` | Декомпозиция задач, создание планов реализации, проектирование шагов |
| Рефакторщик | `refactor` | Рефакторинг кода, оптимизация, очистка |
| Ревьюер | `reviewer` | Ревью кода: безопасность, качество, лучшие практики |
| Тестировщик | `tester` | Написание тестов, улучшение покрытия, помощь с TDD |

## Обращение к агентам

### CLI

```
@reviewer проверь эту функцию на уязвимости
@planner разбей задачу аутентификации на шаги
@debugger у меня NullPointerError на строке 42
```

### HTTP API

```json
{
  "message": "проверь эту функцию на уязвимости",
  "agent": "reviewer"
}
```

### Автоматическая маршрутизация

Если агент не указан, оркестратор направляет автоматически по ключевым словам:

| Ключевые слова | Направляется к |
|---------------|---------------|
| plan, break down, design, architect | `planner` |
| review, check, audit | `reviewer` |
| debug, fix, error, bug, traceback | `debugger` |
| всё остальное | `coder` |

## Архитектура агентов

Каждый агент следует паттерну ReAct (Reason + Act):

```
1. Получить сообщение + контекст
2. Построить системный промпт (специфичный для агента)
3. Вызвать LLM
4. Если LLM хочет использовать инструменты → выполнить → вернуться к шагу 3
5. Если LLM возвращает текст → вернуть как финальный ответ
```

У агентов настраиваемый лимит итераций (по умолчанию: 20) для предотвращения бесконечных циклов.

## Конфигурация агентов

Каждый агент имеет следующие свойства:

| Свойство | Тип | Описание |
|----------|-----|----------|
| `name` | string | Уникальный идентификатор агента |
| `description` | string | Что делает агент (показывается пользователям и оркестратору) |
| `system_prompt` | string | Внедряется как системное сообщение для вызовов LLM |
| `model` | string? | Переопределение модели (null = использовать по умолчанию) |
| `temperature` | float | Температура LLM (0.0–2.0) |
| `max_tokens` | int | Максимум токенов в ответе |
| `tools` | string[] | Разрешённые имена инструментов (пусто = все инструменты) |
| `max_iterations` | int | Максимум итераций цикла ReAct |

## Пользовательские агенты (YAML)

Создавайте пользовательских агентов, добавляя YAML-файлы в:
- `~/.lidco/agents/` (глобальные)
- `.lidco/agents/` (на уровне проекта)

### Пример: `~/.lidco/agents/security.yaml`

```yaml
name: security
description: "Аудитор кода, фокусирующийся на безопасности"
system_prompt: |
  Ты эксперт по безопасности. Анализируй код на уязвимости, включая:
  - SQL-инъекции
  - XSS
  - CSRF
  - Недостатки аутентификации/авторизации
  - Захардкоженные секреты
  - Проблемы валидации ввода

  Оценивай каждую находку как CRITICAL, HIGH, MEDIUM или LOW.
  Предоставляй конкретные рекомендации по исправлению с примерами кода.

model: null          # Использовать модель по умолчанию
temperature: 0.0     # Детерминированный для стабильных аудитов
max_tokens: 4096
tools:
  - file_read
  - glob
  - grep
max_iterations: 10
```

### Пример: `~/.lidco/agents/translator.yaml`

```yaml
name: translator
description: "Переводит код между языками программирования"
system_prompt: |
  Ты переводишь код между языками программирования.
  Сохраняй оригинальную логику, соглашения об именовании и структуру.
  Используй идиоматичные паттерны целевого языка.
  Добавляй комментарии, объясняющие неочевидные преобразования.

temperature: 0.1
max_tokens: 8192
tools: []            # Инструменты не нужны
max_iterations: 1    # Однопроходный перевод
```

Использование:

```
@security проаудируй модуль аутентификации
@translator конвертируй этот Python в Rust
```

## Доступные инструменты

Агенты могут использовать следующие инструменты:

| Инструмент | Описание |
|------------|----------|
| `file_read` | Чтение содержимого файлов |
| `file_write` | Создание/перезапись файлов |
| `file_edit` | Редактирование частей файла |
| `bash` | Выполнение shell-команд |
| `git` | Git-операции |
| `glob` | Поиск файлов по паттерну |
| `grep` | Поиск по содержимому файлов |
