# Решение проблем

## Проблемы с сервером

### "Connection refused" при запуске сервера

**Симптом:** `lidco serve` сразу завершается или curl возвращает "Connection refused".

**Решения:**
1. Проверьте, не занят ли порт:
   ```bash
   # Linux/macOS
   lsof -i :8321
   # Windows
   netstat -ano | findstr :8321
   ```
2. Попробуйте другой порт: `lidco serve --port 9000`
3. Проверьте ошибки импорта: `python -c "from lidco.server.app import create_app; print('OK')"`

### "No module named 'fastapi'" или "No module named 'uvicorn'"

**Решение:** Установите зависимости сервера:
```bash
pip install -e ".[dev]"
# или только серверные зависимости:
pip install fastapi uvicorn[standard] sse-starlette
```

### Сервер возвращает 401 Unauthorized

**Причина:** `LIDCO_API_TOKEN` установлен на сервере, но клиент не отправляет токен.

**Решение:** Либо:
- Уберите токен: `unset LIDCO_API_TOKEN` и перезапустите сервер
- Включите токен в запросы:
  ```bash
  curl -H "Authorization: Bearer ВАШ_ТОКЕН" http://127.0.0.1:8321/api/status
  ```
- В плагине IntelliJ: **Settings** > **Tools** > **LIDCO** > установите API Token

### Сервер возвращает 500 Internal Server Error

**Решение:** Включите режим отладки для подробных ошибок:
```bash
LIDCO_DEBUG=1 lidco serve
```

Проверьте терминал сервера на наличие полных трейсбэков.

### "Could not build project context"

**Симптом:** Предупреждение в логах сервера, эндпоинты контекста возвращают пустое значение.

**Причина:** Сервер не смог проанализировать директорию проекта.

**Решение:** Убедитесь, что `lidco serve` запущен из корня проекта, или укажите:
```bash
lidco serve --project-dir /path/to/your/project
```

---

## Проблемы с плагином

### Плагин не виден после установки

**Решения:**
1. Перезапустите IDE после установки .zip
2. Проверьте **Settings** > **Plugins** > вкладка **Installed** — поищите "LIDCO"
3. Проверьте версию IDE: плагин требует IntelliJ 2024.1+ / Android Studio Koala+

### "LIDCO: offline" в статусной строке

**Причина:** Плагин не может подключиться к серверу LIDCO.

**Решения:**
1. Проверьте, запущен ли сервер: `curl http://127.0.0.1:8321/health`
2. Проверьте URL сервера в **Settings** > **Tools** > **LIDCO**
3. Если используете нестандартный порт, обновите URL: `http://127.0.0.1:9000`
4. Проверьте, не блокирует ли файрвол подключения к localhost

### Действия контекстного меню не появляются

**Причина:** Текст не выделен. Все действия LIDCO в контекстном меню требуют выделения.

**Решение:** Сначала выделите код в редакторе, затем нажмите правую кнопку мыши.

### Alt+L не работает

**Возможные причины:**
1. Конфликт горячих клавиш: **Settings** > **Keymap** > поищите "LIDCO" > проверьте конфликты
2. Сервер не запущен (дополнение требует сервера)
3. Таймаут сервера (по умолчанию 5 сек) — проверьте логи сервера на медленные ответы

### Окно чата показывает "Connection failed"

**Решения:**
1. Проверьте, запущен ли сервер
2. Проверьте URL в настройках плагина
3. При использовании аутентификации убедитесь, что токен совпадает на сервере и в плагине
4. Проверьте логи IDE: **Help** > **Show Log in Explorer/Finder** > поищите "LIDCO" или "LidcoClient"

### Ошибка сборки плагина

**Решения:**
```bash
cd ide/android-studio-plugin

# Очистить и пересобрать
./gradlew clean buildPlugin

# Проверить версию JDK (требуется 17+)
java -version

# Если Gradle wrapper отсутствует
gradle wrapper --gradle-version 8.5
```

---

## Проблемы с CLI

### "No module named 'lidco'"

**Решение:** Установите пакет:
```bash
cd /path/to/lidco
pip install -e ".[dev]"
```

### Ошибки LLM: "API key not found"

**Решение:** Установите API-ключи в `.env`:
```bash
cp .env.example .env
# Отредактируйте .env и добавьте ключи
```

Или экспортируйте напрямую:
```bash
export OPENAI_API_KEY=sk-...
```

### Медленные ответы

**Причины и решения:**
1. **Тяжёлая модель:** Переключитесь на более быструю: `/model gpt-4o-mini`
2. **Много вызовов инструментов:** Агент выполняет обширные файловые операции. Подождите или нажмите Ctrl+C
3. **Сеть:** Проверьте интернет-соединение, попробуйте локальную модель (Ollama)

### Память не сохраняется

**Решения:**
1. Проверьте, что память включена: `cat ~/.lidco/config.yaml` — `memory.enabled` должно быть `true`
2. Проверьте права на директорию: `ls -la ~/.lidco/memory/`
3. Добавьте вручную: `/memory add test_key: тестовое значение`
4. Проверьте: `/memory list`

---

## Получение помощи

1. Проверьте логи сервера (терминал, где запущен `lidco serve`)
2. Проверьте логи IDE: **Help** > **Show Log in Explorer/Finder**
3. Включите отладочное логирование:
   ```bash
   LIDCO_LOG_LEVEL=DEBUG lidco serve
   ```
4. Создайте issue на GitHub с указанием:
   - Версии LIDCO (`lidco --version` или через `/api/status`)
   - Версии IDE (для проблем с плагином)
   - Полного сообщения об ошибке или трейсбэка
   - Шагов для воспроизведения
